{{ define "main" }}
<article class="bg-white rounded shadow-sm border border-slate-100 p-6 md:p-10 mb-8">
    <header class="mb-8">
        <h1 class="text-2xl md:text-3xl font-bold text-slate-800 mb-4">{{ .Title }}</h1>
        {{ if and (not .IsHome) (ne .Slug "about") }}
        {{ if .Date }}
        <p class="text-sm text-slate-500">{{ .Date.Format "2006年1月2日" }}</p>
        {{ end }}
        {{ end }}
    </header>

    {{/* サムネイル画像（目次の上に表示） */}}
    {{ $thumb := partial "get-thumbnail.html" . }}
    {{ if and $thumb (ne .Slug "about") }}
    <div class="mb-8 rounded overflow-hidden" id="hero-thumbnail">
        <img src="{{ $thumb | absURL }}" alt="{{ .Title }}" class="w-full h-auto rounded">
    </div>
    {{ end }}

    {{/* 目次（サムネの下、本文の上に表示） */}}
    {{ if and (not .IsHome) (ne .Slug "about") (ne .Slug "swap") (ne .Slug "privacy") (ne .Slug "contact") (ne .Slug
    "thanks") }}
    {{ if .TableOfContents }}
    <div class="toc-container" id="toc-container">
        <div class="toc-header">
            <span class="toc-title">目次</span>
            <span class="toc-toggle" id="toc-toggle"
                onclick="var c=document.getElementById('toc-content');if(c.style.display==='none'){c.style.display='';this.textContent='[非表示]'}else{c.style.display='none';this.textContent='[表示]'}"
                style="cursor:pointer;color:#3b82f6;">[非表示]</span>
        </div>
        <div class="toc-content" id="toc-content">
            {{ .TableOfContents }}
        </div>
    </div>
    {{ end }}
    {{ end }}

    {{/* 本文 */}}
    <div class="prose prose-slate max-w-none prose-a:text-blue-500 hover:prose-a:text-blue-700" id="article-content">
        {{ .Content | replaceRE "\\*\\*(.+?)\\*\\*" "<strong>$1</strong>" | safeHTML }}
    </div>
</article>

{{/* サムネと同じ画像が本文内にもある場合、本文内の方を非表示にする */}}
{{ if and $thumb (ne .Slug "about") }}
<script>
    (function () {
        var thumb = '{{ $thumb }}';
        var content = document.getElementById('article-content');
        if (!content) return;
        var imgs = content.querySelectorAll('img');
        for (var i = 0; i < imgs.length; i++) {
            var src = imgs[i].getAttribute('src') || '';
            if (src === thumb || src.indexOf(thumb) !== -1 || thumb.indexOf(src.replace(/.*\//, '/')) !== -1) {
                var parent = imgs[i].closest('.separator, div, a');
                if (parent && parent !== content) {
                    parent.style.display = 'none';
                } else {
                    imgs[i].style.display = 'none';
                }
                break;
            }
        }
    })();
</script>
{{ end }}
{{ end }}