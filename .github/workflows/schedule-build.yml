name: Daily Build (Scheduled)

on:
  schedule:
    # 毎日 UTC 08:30 (日本時間 17:30) に実行
    - cron: '30 8 * * *'
  # 手動実行用 (テストなどのため)
  workflow_dispatch:

jobs:
  trigger-build:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Cloudflare Pages Deploy Hook
        # Settings > Secrets and variables > Actions で
        # 登録した `CF_PAGES_DEPLOY_HOOK_URL` にリクエストを投げる
        run: |
          if [ -z "${{ secrets.CF_PAGES_DEPLOY_HOOK_URL }}" ]; then
            echo "Error: CF_PAGES_DEPLOY_HOOK_URL is not set"
            exit 1
          fi
          curl -X POST "${{ secrets.CF_PAGES_DEPLOY_HOOK_URL }}"

      - name: Wait for Cloudflare Pages build to finish
        run: sleep 120

      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: pip install atproto

      - name: Auto Post to Bluesky
        env:
          BLUESKY_HANDLE: ${{ secrets.BLUESKY_HANDLE }}
          BLUESKY_PASSWORD: ${{ secrets.BLUESKY_PASSWORD }}
        run: python .github/scripts/auto_bsky.py
